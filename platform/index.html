<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Autolayout for Web Development</title>
    <style>
    body {
        margin: 0;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        z-index: 0;
    }
    
    .header {
        flex: 0 0 30px;
        border: solid 1px #aaa;
        border-width: 0 0 1px 0;
        background: #e6e6e6;
        z-index: 99999;
        box-shadow: 0 0 20px #777;
    }
    
    .logo {
        display: inline-block;
        height: 30px;
        width: 30px;
        background: url(image/autolayout.png);
        background-size: 30px;
        background-repeat: no-repeat;
        margin: -8px 35px;
    }
    
    .action-bar {
        height: 24px;
        line-height: 24px;
        margin: 3px 0;
        padding: 0;
        display: inline-block;
    }
    
    .action-bar li {
        display: inline-block;
        box-sizing: border-box;
        border: 1px solid #d6d6d6;
        border-radius: 4px;
        padding: 0 5px;
        cursor: pointer;
        background: repeating-linear-gradient(#fff, #f9f9f9 5%, #e6e6e6 30%, #d6d6d6 100%)
    }
    
    .action-bar li:hover {
        box-shadow: 1px 1px 1px #798;
    }
    
    .container {
        display: flex;
        flex: 1 1 auto;
        background: #c9c9c9;
        min-width: 600px;
        z-index: 0;
    }
    
    .navigation-bar {
        overflow: auto;
        resize: horizontal;
        /*order: 1;*/
        width: 150px;
        z-index: 99999;
        background: #e6e6e6;
        box-shadow: 0 0 20px #777;
    }
    .navigation-head{
        height: 25px;
        margin: 10px 0 0 0;
        width: 100%;
        background: #c9c9c9;
        /*text-align: center;*/
        font-size: 15px;
        line-height: 25px;
    }
    .layer-item{
        height: 50px;
        width: 100%;
        margin: 1px 0;
        background: #fff;
    }
    .canvas {
        order: 2;
        flex: 1 1 auto;
        position: relative;
        z-index: 0;
        overflow: hidden;
    }
    .scale-bar{
        position: absolute;
        left: 50px;
        bottom: 50px;
        -webkit-user-select:none;
        height: 30px;
        width: 140px;
        z-index: 99999;
    }
    .scale-small,.scale-status,.scale-large{
        font-family: "微软雅黑";
        font-size: 15px;
        display: inline-block;
        -webkit-user-select:none;
        width: 30px;
        height: 25px;
        box-sizing: border-box;
    }
    .scale-status{
        text-align: center;
        vertical-align: middle;
    }
    
    .tools-bar {
        order: 3;
        flex: 0 0 20vw;
        z-index: 99999;
        background: #e6e6e6;
        box-shadow: 0 0 20px #777;
    }
    
    .tools-moudle {
        height: 300px;
        width: 100%;
        /*background: #798;*/
        border: 1px solid #9c9c9c;
        box-sizing: border-box;
        padding: 5px;
    }
    
    .module {
        position: absolute;
        border-radius: 5px;
        width: 50px;
        height: 50px;
        cursor: pointer;
    }
    .module-symbol{
        border: 1px solid #c5c5c5;
        border-radius: 5px;
        margin: 5px;
        float: left;
        background: #f9f9f9;
        width: 50px;
        height: 50px;
        cursor: pointer;
    }
    .module-lable {
        background: #798;
    }
    
    .module-image {
        background: #473;
    }
    
    .module-button {
        background: blue;
    }
    
    .footer {
        flex: 0 0 5vh;
        border: solid 1px #aaa;
        border-width: 1px 0 0 0;
        background: #e6e6e6;
        z-index: 99999;
        box-shadow: 0 0 20px #777;
    }
    
    .screen {
        position: absolute;
        top: 50px;
        left: 50px;
        box-shadow: 0 0 10px #777;
        z-index: 1;
        zoom :1;
    }
    
    .w414-h736 {
        height: 736px;
        width: 414px;
        background: #fff;
    }
    .test{
        width: 30px;
        height: 30px;
        position: absolute;
        top: 200px;
        left: 150px;
        background: red;
        border-radius: 3px;
    }
    
    </style>
</head>

<body>
    <header class="header">
        <div class="logo"></div>
        <ul class="action-bar">
            <li>文件</li>
            <li>编辑</li>
            <li>选择</li>
            <li>工具</li>
            <li>帮助</li>
        </ul>
    </header>
    <div class="container">
        <div class="navigation-bar">
            <div class="navigation-head">图层</div>
            <div class="layer-list" id="layerList"></div>
        </div>
        <div class="canvas" id="canvasArea">
            <div class="screen w414-h736" id="screenArea">
            </div>
            <div class="scale-bar">
                <button class="scale-small" id="scaleSmall">-</button>
                <span class="scale-status" id="scaleStatus">1.0</span>
                <button class="scale-large" id="scaleLarge">+</button>
            </div>
        </div>
        <div class="tools-bar">
            <div class="tools-moudle">
                <div class="module-symbol module-lable" name="module-symbol" id="module-lable"></div>
                <div class="module-symbol module-image" name="module-symbol" id="module-image"></div>
                <div class="module-symbol module-button" name="module-symbol" id="module-button"></div>
                <div class="module-symbol module-view" name="module-symbol" id="module-view"></div>
            </div>
        </div>
    </div>
    <footer class="footer"></footer>
</body>
<script>
var __MouseOver = "";
var __MouseDownPosition = {x:0,y:0};
var __ScreenStartPosition = {x:50,y:50};
var __ScreenSize = {w:414,h:736}
var __KeyDown = "";
var __ScreenMoving = false;
var __ScreenScale = 1;
var __ModuleSelected = "";
var __ModuleMoving = false;
var __ModuleStartPosition = {x:0,y:0}
var __ShowAllModule = false;


var screenArea  = document.getElementById('screenArea');
var scaleSmallBtn = document.getElementById("scaleSmall");
var scaleLargeBtn = document.getElementById("scaleLarge");
var scaleStatusSpan = document.getElementById("scaleStatus");
var layerList = document.getElementById('layerList');

document.onmouseover = function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];
    __MouseOver = e.target;
}
document.onmousemove =function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];

    if (__KeyDown == 32 && __ScreenMoving) {

        screenArea.style.left = ((e.pageX - __MouseDownPosition.x)/__ScreenScale  + __ScreenStartPosition.x) + "px";
        screenArea.style.top = ((e.pageY - __MouseDownPosition.y)/__ScreenScale  + __ScreenStartPosition.y) + "px";
    }else if(__ModuleMoving){
        __ModuleSelected.style.left = ((e.pageX - __MouseDownPosition.x)/__ScreenScale  + __ModuleStartPosition.x) + "px";
        __ModuleSelected.style.top = ((e.pageY - __MouseDownPosition.y)/__ScreenScale  + __ModuleStartPosition.y) + "px";
       
    }
}
document.onmousedown = function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];
    __MouseDownPosition.x = e.pageX;
    __MouseDownPosition.y = e.pageY;

    if (isChildOfScreen(e.target) && __KeyDown == 32) {
        __ScreenMoving = true;
        __ScreenStartPosition.x =  parseFloat(window.getComputedStyle(screenArea).left) || 50;
        __ScreenStartPosition.y = parseFloat(window.getComputedStyle(screenArea).top) || 50;

    }else if (e.target == scaleSmallBtn) {
        scaleSmallBtn.blur()
        scaleStatusSpan.textContent = 
              screenArea.style.zoom = (__ScreenScale = (parseFloat(scaleStatusSpan.textContent) - 0.1).toFixed(1))+ "";

    }else if (e.target == scaleLargeBtn) {
        scaleLargeBtn.blur()
        scaleStatusSpan.textContent = 
              screenArea.style.zoom = (__ScreenScale = (parseFloat(scaleStatusSpan.textContent) + 0.1).toFixed(1))+ "";
       
    }else if (e.target.name == "module-symbol" || e.target.getAttribute("name") == "module-symbol") {
        newModule = getNewModule(e.target.id);
        screenArea.appendChild(newModule[0]);
        layerList.appendChild(newModule[1]);
    }else if (e.target.name == "module" || e.target.getAttribute("name") == "module") {
        __ModuleSelected = e.target;
        __ModuleMoving = true;
        __ModuleStartPosition.x =  parseFloat(window.getComputedStyle(__ModuleSelected).left) || 0;
        __ModuleStartPosition.y = parseFloat(window.getComputedStyle(__ModuleSelected).top) || 0;
    }else{
        __ModuleSelected = "";
    }
}
document.onmouseup = function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];

    if(__ModuleMoving && !isInScreen(__ModuleSelected)){
        var choice = confirm("要删除该元素吗?");
        if (choice) {
            var connectId = "L" + __ModuleSelected.id.substring(1);
            var connectLayer = document.getElementById(connectId);
            connectLayer.parentNode.removeChild(connectLayer);
            __ModuleSelected.parentNode.removeChild(__ModuleSelected);
            __ModuleSelected = "";
        }else{
            __ModuleSelected.style.left = "0px";
            __ModuleSelected.style.top = "0px";
        }
    }
    __ScreenMoving = false;
    __ModuleMoving = false;
}
document.onkeydown = function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];
    __KeyDown = e.keyCode;

    if ( isChildOfScreen(__MouseOver) && e.keyCode == 32) {
        screenArea.style.cursor = "move";
    } else if(e.keyCode == 86){
        if (__ShowAllModule) {
            screenArea.style.overflow = "hidden";
            __ShowAllModule = false
        }else{
            screenArea.style.overflow = ""
            __ShowAllModule = true;
        }
    }
}

document.onkeyup = function (event) {
    var e = event || window.event || arguments.callee.caller.arguments[0];
    __KeyDown = "";
    if (e.keyCode == 32) {
        screenArea.style.cursor = "auto"
    }
}

function isChildOfScreen (obj){

    if(obj == screenArea || obj.parentNode == screenArea){
        return true;
    }
    return false;
}

function isInScreen (obj) {
    var objStatus = {
        x : parseFloat(window.getComputedStyle(obj).left) || 0,
        y : parseFloat(window.getComputedStyle(obj).top) || 0,
        w : parseFloat(window.getComputedStyle(obj).width) || 50,
        h : parseFloat(window.getComputedStyle(obj).height) || 50,
    };
    
    if(objStatus.x + objStatus.w <= 0 || objStatus.y + objStatus.h <= 0 || objStatus.x > __ScreenSize.w || objStatus.y > __ScreenSize.h){
        return false;
    }else{
        return true;
    }
    
}

function getNewModule (moduleId) {
    var num = parseInt(Math.random()*10000);
    var module = document.createElement("div");
    module.className = "module " + moduleId;
    module.id = "M-" + num; 
    module.style.left = "0px";
    module.style.top = "0px";
    module.setAttribute("name","module");

    var layer = document.createElement("div");
    layer.className = "layer-item";
    layer.id = "L-" + num;
    layer.innerText = num;

    return [module, layer];
}
</script>

</html>
